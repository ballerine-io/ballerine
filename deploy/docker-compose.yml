version: '3'
services:
  backoffice:
    build:
      context: ../apps/backoffice-v2/
      args:
        NPM_LOG_LEVEL: notice
    ports:
      - 5137:5137
    environment:
      VITE_API_URL: http://service:3000/api/v1/internal
      VITE_API_KEY: demo
      VITE_AUTH_ENABLED: "true"
      VITE_MOCK_SERVER: "false"
      VITE_POLLING_INTERVAL: 10
      VITE_API_KEY: "KVfOlhMgK1V3MXTSHOTACgrAUK9qeI"
      VITE_ASSIGNMENT_POLLING_INTERVAL: 5
    depends_on:
      - service
    restart: on-failure
  headlessservice:
    build:
      context: ../examples/headless-example
      args:
        NPM_LOG_LEVEL: notice
    ports:
      - 5173:5173
    depends_on:
      - service
    restart: on-failure
  service:
    build:
      context: ../services/workflows-service/
      args:
        NPM_LOG_LEVEL: notice
    ports:
      - 3000:3000
    environment:
      BCRYPT_SALT: 10
      JWT_SECRET_KEY: "secret"
      JWT_EXPIRATION: "10d"
      DB_URL: postgres://admin:admin@db:5432
      API_KEY: "secret"
      NODE_ENV: "development"
      COMPOSE_PROJECT_NAME: "ballerine-x"
      DB_PORT: "5432"
      DB_USER: "admin"
      DB_PASSWORD: "admin"
      SESSION_SECRET: "iGdnj4A0YOhj8dHJK7IWSvQKEZsG7P70FFehuddhFPjtg/bSkzFejYILk4Xue6Ilx9y3IAwzR8pV1gb4"
      BACKOFFICE_CORS_ORIGIN: "http://backoffice:5137"
      HEADLESS_EXAMPLE_CORS_ORIGIN: "http://backoffice:5173"
      PORT: "3000"
    depends_on:
      - db
    restart: on-failure
  db:
    image: postgres:12
    ports:
      - 5432:5432
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: admin
    volumes:
      - ./postgres:/var/lib/postgresql/data
    healthcheck:
      test:
        - CMD
        - pg_isready
      timeout: 45s
      interval: 10s
      retries: 10
volumes:
  postgres: ~
